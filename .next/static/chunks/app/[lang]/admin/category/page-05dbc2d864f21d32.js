(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[968],{24280:function(e,t,a){Promise.resolve().then(a.bind(a,18695)),Promise.resolve().then(a.bind(a,29674)),Promise.resolve().then(a.t.bind(a,88598,23)),Promise.resolve().then(a.t.bind(a,72850,23)),Promise.resolve().then(a.bind(a,60070)),Promise.resolve().then(a.bind(a,66964)),Promise.resolve().then(a.bind(a,27402)),Promise.resolve().then(a.bind(a,441)),Promise.resolve().then(a.bind(a,24853)),Promise.resolve().then(a.bind(a,55203)),Promise.resolve().then(a.bind(a,74647)),Promise.resolve().then(a.t.bind(a,8405,23)),Promise.resolve().then(a.t.bind(a,16139,23))},18695:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Content}});var r=a(76130),n=a(45084),s=a(5687),o=a.n(s),c=a(25332),l=a(18030),i=a(79014),d=a(15885);function Content(e){let{lang:t,defaultLang:a,locales:s,localeLabels:g}=e,{register:m,handleSubmit:u,getValues:_,reset:h,setValue:y,trigger:p,formState:{errors:x},control:v}=(0,i.cI)({mode:"onChange"}),{register:j,handleSubmit:b,getValues:f,reset:N,setValue:w,trigger:k,formState:{errors:P},control:C}=(0,i.cI)({mode:"onChange"}),S=(0,n.useRef)(null),T=(0,n.useRef)(null),[O,F]=(0,n.useState)(t),[q,A]=(0,n.useState)(t),[z,L]=(0,n.useState)(null),[V,E]=(0,n.useState)(0),[X,Z]=(0,n.useState)(null);async function categoryTreeUpdate(){T.current=await getCategory(),L(function getCategoryNode(e){return(0,r.jsx)("ul",{role:"tree",className:o().category_group,children:e.map((e,a)=>(0,r.jsxs)("li",{role:"treeitem",tabIndex:0,children:[(0,r.jsxs)("div",{className:o().item,onMouseOver:e=>{e.stopPropagation(),e.currentTarget.style.backgroundColor="var( --background-secondary-color )",e.currentTarget.childNodes[3].style.opacity="1"},onMouseOut:e=>{e.stopPropagation(),e.currentTarget.style.removeProperty("background-color"),e.currentTarget.childNodes[3].style.removeProperty("opacity")},children:[(0,r.jsx)("span",{className:o().icon,children:e.icon?(0,r.jsx)("img",{src:"../api/media-stream/icon?id=".concat(e.id),"aria-label":"アイコン",loading:"lazy"}):(0,r.jsx)(c.G,{icon:l.cLY})}),e.name[t],(0,r.jsx)("span",{style:{marginLeft:"15px",color:"gray"},children:e.slug}),(0,r.jsxs)("span",{className:o().control,children:[(0,r.jsx)("button",{"data-name":e.name[t],"data-slug":e.slug,"data-icon":e.icon||"none","data-id":e.id,"data-rank":e.rank,"data-parent":e.parent,onClick:t=>{let a=t.currentTarget.dataset;if(a.name&&a.slug&&a.rank&&a.parent&&a.id){for(let t of(E(1),Z({name:a.name,slug:a.slug,rank:a.rank,parent:a.parent,icon:a.icon||"none",id:a.id}),w("category_id",a.id),s))w("category_name_".concat(t),e.name[t]);w("category_slug",a.slug),w("category_rank",a.rank),N({category_icon:null}),w("category_parent",a.parent)}},children:"編集"}),"\xa0/\xa0",(0,r.jsx)("button",{"data-id":e.id,children:"削除"})]})]}),e.children.length>0&&getCategoryNode(e.children)]}))})}(T.current))}async function getCategory(){return new Promise(e=>{fetch("/api/category/get",{method:"POST",cache:"no-store"}).then(async t=>{if(t.ok){let a=await t.json();console.log(a);let searchEdit=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=[];for(let[r,n]of e.entries())t===n.parent&&a.push({...n,children:searchEdit(e,n.id)});return a};S.current=a,e(searchEdit(a,0))}})})}function registerCategory(e,t){let a=new FormData(t);a.set("category_parent","new"===e?_("category_parent"):f("category_parent")),fetch("/api/category/".concat("new"===e?"create":"update"),{method:"POST",body:a,cache:"no-store"}).then(async t=>{console.log(t.ok),t.ok?(alert("⭕カテゴリーを".concat("new"===e?"追加":"更新","しました。")),"new"===e&&h(),categoryTreeUpdate()):alert("❌カテゴリーの".concat("new"===e?"追加":"更新","に失敗しました。"))})}function getParentSelectComponent(e,a,n,s,o){let c=[{label:"なし（ルート）",value:"0"},...n.map(e=>({label:"".concat(e.name[t]," [").concat(e.slug,"]"),value:"".concat(e.id)}))];if(o){for(let e of c)if(e.value===o)break}return(0,r.jsx)(i.Qr,{name:a,rules:{required:!0},defaultValue:null!=o?o:"0",control:e,render:e=>{let{field:{onChange:t,value:a}}=e;return(0,r.jsx)(d.ZP,{options:c,styles:{option:e=>({...e,color:"var( --foreground-color )"}),control:e=>({...e,color:"var( --foreground-color )"}),singleValue:e=>({...e,color:"var( --foreground-color )"})},value:c.find(e=>e.value===a),onChange:e=>e&&t(e.value),maxMenuHeight:300,menuPortalTarget:document.body,theme:e=>({...e,borderRadius:0,colors:{...e.colors,primary:"var( --react-select-primary )",primary25:"var( --react-select-primary25 )",neutral0:"var( --react-select-neutral0 )",neutral80:"white"}}),"aria-labelledby":s})}})}(0,n.useEffect)(()=>{categoryTreeUpdate()},[]);let U=(0,n.useCallback)(async e=>{let t=await fetch("/api/category/slug-exist",{method:"POST",body:JSON.stringify({slug:e})});if(t.ok){let{isExist:e}=await t.json();return!e||"既に同名のスラグが存在します。"}return"スラグの確認処理で、ネットワークエラーが発生しました。"},[]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{className:o().heading2,children:"カテゴリー"}),(0,r.jsxs)("div",{className:o().category_manage_wrap,children:[(0,r.jsxs)("div",{className:o().category_tree_wrap,children:[(0,r.jsx)("h3",{children:"登録カテゴリー一覧"}),(0,r.jsx)("button",{className:o().cat_new,onClick:()=>{E(0),Z(null),N()},children:"新規追加"}),(0,r.jsx)("div",{className:o().tree,children:z&&z})]}),(0,r.jsxs)("div",{className:o().category_register_wrap,children:[(0,r.jsxs)("div",{className:o().form_switch,hidden:0!==V,children:[(0,r.jsx)("h3",{children:"新規追加"}),(0,r.jsxs)("form",{onSubmit:u((e,t)=>{registerCategory("new",null==t?void 0:t.target)}),children:[(0,r.jsxs)("div",{className:o().form_item,children:[(0,r.jsx)("div",{className:o().lang_tabs,children:s.length>1&&s.map(e=>(0,r.jsx)("button",{type:"button",className:"".concat(o().tab," ").concat(O===e&&o().selected),onClick:()=>{F(e)},children:g[t][e]}))}),(0,r.jsx)("div",{className:o().tab_content,children:s.map(e=>{var t,a;return(0,r.jsxs)("div",{className:"".concat(o().content," ").concat(O===e&&o().show),children:[(0,r.jsx)("label",{htmlFor:"category-name-input",children:"カテゴリー名"}),(0,r.jsx)("input",{type:"text",id:"category-name-input",...m("category_name_".concat(e),{required:{value:!0,message:"入力必須項目です。"},maxLength:{value:50,message:"50文字以内で入力してください。"}})}),(null===(t=x["category_name_".concat(e)])||void 0===t?void 0:t.message)&&(0,r.jsx)("span",{className:o().error_message,children:null===(a=x["category_name_".concat(e)])||void 0===a?void 0:a.message})]})})})]}),(0,r.jsxs)("div",{className:o().form_item,children:[(0,r.jsx)("label",{htmlFor:"category-slug-input",children:"スラッグ（半角英数字[A-Za-z0-9_-]）"}),(0,r.jsx)("input",{type:"text",id:"category-slug-input",...m("category_slug",{required:{value:!0,message:"入力必須項目です。"},maxLength:{value:50,message:"50文字以内で入力してください。"},pattern:{value:/^[A-Za-z0-9_-]+$/g,message:"形式が正しくありません。"},validate:async e=>U(e)})}),x.category_slug&&x.category_slug.message&&(0,r.jsx)("span",{className:o().error_message,children:x.category_slug.message})]}),(0,r.jsxs)("div",{className:o().form_item,children:[(0,r.jsx)("label",{htmlFor:"category-rank-input",children:"ランク（数値）"}),(0,r.jsx)("input",{type:"number",id:"category-rank-input",...m("category_rank",{required:{value:!0,message:"入力必須項目です。"}}),defaultValue:"0"}),x.category_rank&&x.category_rank.message&&(0,r.jsx)("span",{className:o().error_message,children:x.category_rank.message})]}),(0,r.jsxs)("div",{className:o().form_item,children:[(0,r.jsx)("label",{id:"category-parent-input",children:"親カテゴリー（表示専用）"}),z&&getParentSelectComponent(v,"category_parent",S.current,"category-parent-input")]}),(0,r.jsxs)("div",{className:o().form_item,children:[(0,r.jsx)("label",{htmlFor:"category-icon-input",children:"アイコン"}),(0,r.jsx)("input",{type:"file",id:"category-icon-input",accept:"image/*",...m("category_icon")}),(0,r.jsx)("span",{children:"※推奨サイズ：50 X 50ピクセル程度"})]}),(0,r.jsx)("div",{className:o().form_item,style:{textAlign:"center"},children:(0,r.jsx)("button",{type:"submit",className:o().add_category_btn,children:"追加"})})]})]}),(0,r.jsxs)("div",{className:o().form_switch,hidden:1!==V,children:[(0,r.jsxs)("h3",{children:["編集 - ",X&&X.name]}),(0,r.jsxs)("form",{onSubmit:b((e,t)=>{registerCategory("edit",null==t?void 0:t.target)}),children:[(0,r.jsxs)("div",{className:o().form_item,children:[(0,r.jsx)("div",{className:o().lang_tabs,children:s.length>1&&s.map(e=>(0,r.jsx)("button",{type:"button",className:"".concat(o().tab," ").concat(q===e&&o().selected),onClick:()=>{A(e)},children:g[t][e]}))}),(0,r.jsx)("div",{className:o().tab_content,children:s.map(e=>{var t,a;return(0,r.jsxs)("div",{className:"".concat(o().content," ").concat(q===e&&o().show),children:[(0,r.jsx)("label",{htmlFor:"category-name-input",children:"カテゴリー名"}),(0,r.jsx)("input",{type:"text",id:"category-name-input",...j("category_name_".concat(e),{required:{value:!0,message:"入力必須項目です。"},maxLength:{value:50,message:"50文字以内で入力してください。"}})}),(null===(t=P["category_name_".concat(e)])||void 0===t?void 0:t.message)&&(0,r.jsx)("span",{className:o().error_message,children:null===(a=P["category_name_".concat(e)])||void 0===a?void 0:a.message})]})})})]}),(0,r.jsxs)("div",{className:o().form_item,children:[(0,r.jsx)("label",{htmlFor:"category-slug-input",children:"スラッグ（半角英数字[A-Za-z0-9_-]）"}),(0,r.jsx)("input",{type:"text",id:"category-slug-input",...j("category_slug",{required:{value:!0,message:"入力必須項目です。"},maxLength:{value:50,message:"50文字以内で入力してください。"},pattern:{value:/^[A-Za-z0-9_-]+$/g,message:"形式が正しくありません。"}})}),P.category_slug&&P.category_slug.message&&(0,r.jsx)("span",{className:o().error_message,children:P.category_slug.message})]}),(0,r.jsxs)("div",{className:o().form_item,children:[(0,r.jsx)("label",{htmlFor:"category-rank-input",children:"ランク（数値）"}),(0,r.jsx)("input",{type:"number",id:"category-rank-input",...j("category_rank",{required:{value:!0,message:"入力必須項目です。"}})}),P.category_rank&&P.category_rank.message&&(0,r.jsx)("span",{className:o().error_message,children:P.category_rank.message})]}),(0,r.jsxs)("div",{className:o().form_item,children:[(0,r.jsx)("label",{id:"category-parent-input",children:"親カテゴリー"}),z&&getParentSelectComponent(C,"category_parent",S.current,"category-parent-input")]}),(0,r.jsxs)("div",{className:o().form_item,children:[(0,r.jsx)("label",{htmlFor:"category-icon-input",children:"アイコン"}),(0,r.jsx)("input",{type:"file",id:"category-icon-input",accept:"image/*",...j("category_icon")}),(0,r.jsx)("span",{children:"※推奨サイズ：50 X 50ピクセル程度"})]}),(0,r.jsxs)("div",{className:o().form_item,style:{textAlign:"center"},children:[(0,r.jsx)("input",{type:"hidden",...j("category_id",{required:!0})}),(0,r.jsx)("button",{type:"submit",className:o().add_category_btn,children:"更新"})]})]})]})]})]})]})}},5687:function(e){e.exports={heading2:"content_heading2__cntOu",category_manage_wrap:"content_category_manage_wrap__Qo9bR",category_tree_wrap:"content_category_tree_wrap__BsPWi",cat_new:"content_cat_new__squ6W",tree:"content_tree___jHoW",category_group:"content_category_group__z0iAN",item:"content_item__AmPAD",icon:"content_icon__ktwvc",control:"content_control__BO_ru",focus:"content_focus__jBUYX",category_register_wrap:"content_category_register_wrap__yKmzx",form_switch:"content_form_switch__p9eyw",form_item:"content_form_item__eLW4_",lang_tabs:"content_lang_tabs__5z3Xj",tab:"content_tab__euPw7",selected:"content_selected__Xrm5p",tab_content:"content_tab_content__3_OOW",content:"content_content__XJL7Y",show:"content_show__TQVKF",error_message:"content_error_message__Z6yBl",add_category_btn:"content_add_category_btn__SUSr5"}}},function(e){e.O(0,[314,530,359,97,885,969,180,622,744],function(){return e(e.s=24280)}),_N_E=e.O()}]);