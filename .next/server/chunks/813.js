exports.id=813,exports.ids=[813],exports.modules={43714:(e,t,a)=>{let s={a6807987f4440f18f6ff2e7f95ec7feff833f79f:()=>Promise.resolve().then(a.bind(a,54318)).then(e=>e.getComments),"01d6f3e04c5fa1e46ec5d6b764a153323f01bc67":()=>Promise.resolve().then(a.bind(a,54318)).then(e=>e.createNewComment)};async function endpoint(e,...t){let a=await s[e]();return a.apply(null,t)}e.exports={a6807987f4440f18f6ff2e7f95ec7feff833f79f:endpoint.bind(null,"a6807987f4440f18f6ff2e7f95ec7feff833f79f"),"01d6f3e04c5fa1e46ec5d6b764a153323f01bc67":endpoint.bind(null,"01d6f3e04c5fa1e46ec5d6b764a153323f01bc67")}},64272:(e,t,a)=>{Promise.resolve().then(a.bind(a,41748)),Promise.resolve().then(a.bind(a,10349)),Promise.resolve().then(a.bind(a,95847)),Promise.resolve().then(a.bind(a,5404)),Promise.resolve().then(a.bind(a,812)),Promise.resolve().then(a.bind(a,54347)),Promise.resolve().then(a.bind(a,45528)),Promise.resolve().then(a.bind(a,37144)),Promise.resolve().then(a.bind(a,11175)),Promise.resolve().then(a.bind(a,81194)),Promise.resolve().then(a.t.bind(a,62179,23)),Promise.resolve().then(a.t.bind(a,22272,23)),Promise.resolve().then(a.t.bind(a,44742,23)),Promise.resolve().then(a.t.bind(a,51846,23)),Promise.resolve().then(a.bind(a,62796))},41748:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>Discussion});var s=a(92983),i=a(958),n=a.n(i),r=a(76078),l=a(37264);a(27035),a(96162);var c=a(25017),d=(0,c.$)("01d6f3e04c5fa1e46ec5d6b764a153323f01bc67"),o=(0,c.$)("a6807987f4440f18f6ff2e7f95ec7feff833f79f");function Discussion({lang:e,postId:t}){let[a,i]=(0,l.experimental_useFormState)(d,null),[c,m]=(0,l.experimental_useFormState)(o,null),[_,p]=(0,r.useState)([]),[h,f]=(0,r.useState)({nicname:"",email:"",body:""});return(0,r.useEffect)(()=>{a&&(p(e=>[...e,(0,s.jsxs)("article",{className:n().item,children:[(0,s.jsxs)("header",{className:n().meta,children:[(0,s.jsxs)("span",{className:n().nicname,children:["送信者：",a.nicname]}),(0,s.jsxs)("span",{className:n().id,children:["ID:",a.id]})]}),s.jsx("div",{className:n().content,dangerouslySetInnerHTML:{__html:a.body}})]},a.id)]),f(e=>(e.nicname="",e.email="",e.body="",e))),c?c&&!a&&p(c.map(e=>(0,s.jsxs)("article",{className:n().item,children:[(0,s.jsxs)("header",{className:n().meta,children:[(0,s.jsxs)("span",{className:n().nicname,children:["送信者：",e.nicname]}),(0,s.jsxs)("span",{className:n().id,children:["ID:",e.id]})]}),s.jsx("div",{className:n().content,dangerouslySetInnerHTML:{__html:e.body}})]},e.id))):m(t)},[a,c]),(0,s.jsxs)("div",{className:n().client,children:[_,s.jsx("hr",{}),(0,s.jsxs)("form",{action:i,className:n().comment_form,children:[(0,s.jsxs)("div",{className:n().item,children:[s.jsx("label",{htmlFor:"comment-nicname-input",children:"ニックネーム*"}),s.jsx("input",{type:"text",name:"nicname",id:"comment-nicname-input",value:h.nicname,onChange:e=>f(t=>({...t,nicname:e.target.value}))})]}),(0,s.jsxs)("div",{className:n().item,children:[s.jsx("label",{htmlFor:"comment-email-input",children:"メールアドレス*"}),s.jsx("input",{type:"email",name:"email",id:"comment-email-input",value:h.email,onChange:e=>f(t=>({...t,email:e.target.value}))})]}),s.jsx("div",{className:`${n().item} ${n().block}`,children:s.jsx("textarea",{name:"body",placeholder:"ここに内容を入力",value:h.body,onChange:e=>f(t=>({...t,body:e.target.value}))})}),(0,s.jsxs)("div",{className:n().submit_wrap,children:[s.jsx("input",{type:"hidden",name:"post_id",value:t}),s.jsx("button",{type:"submit",className:n().submit,children:"送信"})]})]})]})}},958:e=>{e.exports={client:"discussion_client__TBHbD",item:"discussion_item__1ZqNr",meta:"discussion_meta__gDcCu",nicname:"discussion_nicname__8fuEw",id:"discussion_id__aPgNu",content:"discussion_content__8ej1s",comment_form:"discussion_comment_form__f6QW6",block:"discussion_block__e6mnn",submit_wrap:"discussion_submit_wrap__62jF_",submit:"discussion_submit__pcjUE"}},80431:e=>{e.exports={main:"page_main__Apaff",post_container:"page_post_container__NWjLI",post_title_wrap:"page_post_title_wrap__3Kx_Z",post_meta:"page_post_meta__lWAUU",categorys:"page_categorys__K_k49",category:"page_category__Sguhn",link_wrap:"page_link_wrap__DUEo_",icon:"page_icon__F4dKE",image_wrap:"page_image_wrap__siyDb",name:"page_name__x1h8a",datetime:"page_datetime__XuY_X",register_date:"page_register_date__BX6_u",update_date:"page_update_date__t2GzG",view:"page_view__nNOab",post_content:"page_post_content__FiZ8V",post_content_top:"page_post_content_top__dhFz9",thumbnail:"page_thumbnail__IqZgB",insert_html:"page_insert_html__kSWbI",discussion_wrap:"page_discussion_wrap__a3Trj",content:"page_content__hoQGe"}},3372:e=>{e.exports={before_after_link:"postBeforeAfter_before_after_link__wkkZ9",link_bar:"postBeforeAfter_link_bar__sPeCV",icon_angle:"postBeforeAfter_icon_angle__UDTHz",post_title:"postBeforeAfter_post_title__rIcgU",left:"postBeforeAfter_left__qdv_Z",right:"postBeforeAfter_right__vIPCV"}},86346:e=>{e.exports={related_articles:"related_related_articles__2hQl_",articles:"related_articles__N7loF",permalink:"related_permalink__43wIa",entry:"related_entry__gBF0z",thumbnail:"related_thumbnail__VZYfx",title:"related_title__Em0Xw"}},54318:(e,t,a)=>{"use strict";a.r(t),a.d(t,{createNewComment:()=>createNewComment,getComments:()=>getComments});var s=a(56450),i=a(53524),n=a(80959),r=a.n(n),l=a(47470);let c=new i.PrismaClient;async function createNewComment(e,t){let a=t.get("nicname"),s=t.get("email"),i=t.get("body"),n=t.get("post_id");if(!a||!s||!i||!n)return null;let l=c.discussion.create({data:{nicname:a.toString(),body:r()(i.toString(),{allowedTags:[]}).replaceAll("\n","<br/>").replaceAll(/(<br\/>){3,}/g,"<br/><br/>"),sender_info:{email:s.toString()},Post:{connect:{id:Number(n?.toString())}}}});return l}async function getComments(e,t){if(!t)return null;let a=await c.discussion.findMany({where:{post_id:t}});return a}(0,l.h)([createNewComment,getComments]),(0,s.U)("01d6f3e04c5fa1e46ec5d6b764a153323f01bc67",null,createNewComment),(0,s.U)("a6807987f4440f18f6ff2e7f95ec7feff833f79f",null,getComments)},33118:(e,t,a)=>{"use strict";a.r(t),a.d(t,{ArticleCommon:()=>ArticleCommon,DiscussionComponent:()=>DiscussionComponent,default:()=>Article,generateMetadata:()=>generateMetadata,getPost:()=>getPost});var s=a(55041),i=a(83873),n=a(56614),r=a(86346),l=a.n(r),c=a(3372),d=a.n(c),o=a(53524),m=a(24978),_=a(12869),p=a(30425),h=a.n(p);let f=new o.PrismaClient;async function PostBeforeAfter({lang:e,postDate:t}){let a=await f.post.findFirst({where:{register_date:{lt:t}},orderBy:{register_date:"desc"},select:{id:!0,title:!0,permalink:!0}}),i=await f.post.findFirst({where:{register_date:{gt:t}},orderBy:{register_date:"asc"},select:{id:!0,title:!0,permalink:!0}});return(0,s.jsxs)("div",{className:d().before_after_link,children:[a&&(0,s.jsxs)(h(),{className:`${d().link_bar} ${d().left}`,href:`/article${a.permalink?`/${a.permalink}`:`?id=${a.id}`}`,children:[s.jsx("span",{className:d().icon_angle,children:s.jsx(m.FontAwesomeIcon,{icon:_.EyR})}),s.jsx("span",{className:d().post_title,children:a.title[e]})]}),i&&(0,s.jsxs)(h(),{className:`${d().link_bar} ${d().right}`,href:`/article${i.permalink?`/${i.permalink}`:`?id=${i.id}`}`,children:[s.jsx("span",{className:d().post_title,style:{textAlign:"right"},children:i.title[e]}),s.jsx("span",{className:d().icon_angle,children:s.jsx(m.FontAwesomeIcon,{icon:_.yOZ})})]})]})}let g=new o.PrismaClient;async function Related({lang:e,categories:t,postId:a,postDate:i}){let n=await g.post.findMany({where:{CategoryPost:{some:{categoryId:{in:t.map(e=>e.category.id)}}},NOT:{id:a}},select:{id:!0,title:!0,permalink:!0,media:{select:{id:!0,url:!0}}},take:8,orderBy:{update_date:"desc"}});return(0,s.jsxs)("aside",{className:l().related_articles,children:[s.jsx("h2",{children:"Related Articles"}),s.jsx("div",{className:l().articles,children:n.map(t=>{let a=t.permalink?`/article/${t.permalink}`:`/article?id=${t.id}`;return s.jsx(h(),{className:l().permalink,href:a,children:(0,s.jsxs)("article",{className:l().entry,children:[s.jsx("div",{className:l().thumbnail,children:t.media?s.jsx("img",{src:`/api/media-stream?id=${t.media.id}&w=${Object.keys(t.media.url.paths)[0]}`,alt:"thumbnail",loading:"lazy"}):s.jsx("img",{src:"/static-img/no-image.svg",alt:"thumbnail",loading:"lazy"})}),s.jsx("div",{className:l().title,children:s.jsx("h3",{children:t.title[e]})})]})})})}),s.jsx(PostBeforeAfter,{lang:e,postDate:i})]})}var u=a(89385);let x=(0,u.createProxy)(String.raw`/var/www/next-creator/app/[lang]/article/discussion.tsx`),{__esModule:j,$$typeof:b}=x,y=x.default;var N=a(40888),w=a(50217),v=a(64042),P=a.n(v),C=a(80431),k=a.n(C),A=a(38584),$=a(11208),S=a(54318),I=a(7408);async function getPost(e){return fetch(`${process.env.API_ACCESS_ADDRESS}/api/post/get`,{method:"POST",body:JSON.stringify({id:Number(e)}),headers:{API_ACCESS_TOKEN:process.env.API_ACCESS_TOKEN},next:{revalidate:30}})}async function generateMetadata({params:{lang:e},searchParams:t},a){let s=t.id;s||(0,$.redirect)("/");let i=await getPost(s),n=null;if(!i.ok)return(0,$.redirect)("/");(n=await i.json())&&0!==Object.keys(n).length||(0,$.redirect)("/");let r=await a,l=r.openGraph?.images||[],c="";if(n.media){delete n.media.url.paths.default;let e=Object.keys(n.media.url.paths)[0];c=`${process.env.APP_URL}/api/media-stream?id=${n.media.id}&w=${e}`}return{title:n.title[e],description:n.description?n.description[e]:"",openGraph:{images:[...l,c],description:n.description?n.description[e]:"",siteName:r.openGraph?.siteName,type:"website"}}}async function Article({params:{lang:e},searchParams:t}){let a=await getPost(t.id),i=await a.json();return s.jsx(ArticleCommon,{postData:i,lang:e})}async function ArticleCommon({postData:e,lang:t}){let a=(0,I.ET)("y-m-d h:mi",e.register_date),r=(0,I.ET)("y-m-d h:mi",e.update_date),l=a!==r;return e&&e.media&&e.media.url.paths.default&&delete e.media.url.paths.default,(0,s.jsxs)(s.Fragment,{children:[s.jsx(i.Z,{lang:t}),s.jsx(n.Z,{children:s.jsx("main",{className:`${k().main}`,children:(0,s.jsxs)("article",{className:k().post_container,children:[(0,s.jsxs)("header",{className:"animate__animated animate__fadeInDown animate__fast "+k().post_title_wrap,children:[s.jsx("h1",{children:e?e.title[t]:""}),(0,s.jsxs)("div",{className:k().post_meta,children:[s.jsx("div",{className:k().categorys,children:e.CategoryPost.map(e=>s.jsx("span",{className:k().category,children:(0,s.jsxs)(h(),{className:k().link_wrap,href:`/category/${e.category.slug}`,children:[s.jsx("span",{className:k().icon,children:e.category.icon_mime?s.jsx("span",{className:k().image_wrap,children:s.jsx("img",{src:`../api/media-stream/icon?id=${e.category.id}`,loading:"lazy",alt:`${e.category.name[t]} - アイコン`})}):s.jsx(m.FontAwesomeIcon,{icon:_.olY})}),s.jsx("span",{className:k().name,children:e.category.name[t]})]})},e.category.id))}),(0,s.jsxs)("div",{className:k().datetime,children:[l&&(0,s.jsxs)("span",{className:k().update_date,children:["更新日：",s.jsx("time",{dateTime:e.update_date,children:r})]}),s.jsx("span",{className:k().register_date,children:l?(0,s.jsxs)(s.Fragment,{children:["登校日：",s.jsx("span",{className:k().view,children:a})]}):(0,s.jsxs)(s.Fragment,{children:["投稿日：",s.jsx("time",{dateTime:e.register_date,children:a})]})})]})]})]}),(0,s.jsxs)("section",{className:"animate__animated animate__fadeIn "+k().post_content,children:[s.jsx("div",{className:k().post_content_top,children:e.media&&s.jsx("figure",{className:k().thumbnail,children:s.jsx("img",{src:`http://ryuseiweb.localhost/api/media-stream?w=800&id=${e.media.id}`,srcSet:Object.keys(e.media.url.paths).map(t=>`http://ryuseiweb.localhost/api/media-stream?w=${t}&id=${e.media.id} w${t}`).join(", "),sizes:"100vw",width:Object.keys(e.media.url.paths).splice(-1)[0],alt:`記事のサムネイル画像`,loading:"lazy"})})}),s.jsx("div",{id:"insert_post_html",className:k().insert_html,dangerouslySetInnerHTML:{__html:e?e?.body[t]:""}}),s.jsx(Related,{lang:t,postId:e.id,postDate:e.register_date,categories:e.CategoryPost}),(0,s.jsxs)("section",{className:k().discussion_wrap,children:[s.jsx("h2",{children:"Discussion"}),(0,s.jsxs)("div",{className:k().content,children:[s.jsx(DiscussionComponent,{lang:t,postId:e.id}),s.jsx(y,{lang:t,postId:e.id})]})]})]}),s.jsx(N.Z,{useLang:t,defaultLang:A.S.ZP,locales:A.S.Z5,localeLabels:A.S.p8})]})})}),s.jsx(P(),{src:`${process.env.APP_URL}/scripts/article.js`,strategy:"lazyOnload"}),s.jsx(w.Z,{})]})}async function DiscussionComponent({postId:e,lang:t}){let a=await (0,S.getComments)(void 0,e);return a&&a.length>0?s.jsx("div",{style:{display:"none"},children:a.map(e=>(0,s.jsxs)("article",{className:k().item,children:[(0,s.jsxs)("header",{className:k().meta,children:[(0,s.jsxs)("span",{className:k().nicname,children:["送信者：",e.nicname]}),(0,s.jsxs)("span",{className:k().id,children:["ID:",e.id]})]}),s.jsx("div",{className:k().content,dangerouslySetInnerHTML:{__html:e.body}})]},e.id))}):s.jsx(s.Fragment,{})}}};