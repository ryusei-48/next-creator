(()=>{var e={};e.id=1968,e.ids=[1968],e.modules={53524:e=>{"use strict";e.exports=require("@prisma/client")},67096:e=>{"use strict";e.exports=require("bcrypt")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},41790:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page-experimental.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},73292:e=>{"use strict";e.exports=require("fs/promises")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},63477:e=>{"use strict";e.exports=require("querystring")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},19592:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>o.a,__next_app__:()=>u,originalPathname:()=>d,pages:()=>g,routeModule:()=>m,tree:()=>l});var a=r(10426),n=r(19361),s=r(19234),o=r.n(s),i=r(76566),c={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);r.d(t,c);let l=["",{children:["[lang]",{children:["admin",{children:["category",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,69184)),"/var/www/next-creator/app/[lang]/admin/category/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,75300)),"/var/www/next-creator/app/[lang]/layout.tsx"],error:[()=>Promise.resolve().then(r.bind(r,84643)),"/var/www/next-creator/app/[lang]/error.tsx"],loading:[()=>Promise.resolve().then(r.bind(r,94954)),"/var/www/next-creator/app/[lang]/loading.tsx"]}]},{"not-found":[()=>Promise.resolve().then(r.t.bind(r,16452,23)),"next/dist/client/components/not-found-error"]}],g=["/var/www/next-creator/app/[lang]/admin/category/page.tsx"],d="/[lang]/admin/category/page",u={require:r,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/[lang]/admin/category/page",pathname:"/[lang]/admin/category",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},88707:(e,t,r)=>{Promise.resolve().then(r.bind(r,21326)),Promise.resolve().then(r.bind(r,10349)),Promise.resolve().then(r.bind(r,95847)),Promise.resolve().then(r.bind(r,5404)),Promise.resolve().then(r.bind(r,812)),Promise.resolve().then(r.bind(r,54347)),Promise.resolve().then(r.bind(r,45528)),Promise.resolve().then(r.bind(r,11175)),Promise.resolve().then(r.bind(r,81194)),Promise.resolve().then(r.t.bind(r,22272,23)),Promise.resolve().then(r.t.bind(r,51846,23))},21326:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>Content});var a=r(92983),n=r(76078),s=r(42523),o=r.n(s),i=r(26515),c=r(93026),l=r(7247),g=r(22187);function Content({lang:e,defaultLang:t,locales:r,localeLabels:s}){let{register:d,handleSubmit:u,getValues:m,reset:_,setValue:p,trigger:y,formState:{errors:h},control:x}=(0,l.cI)({mode:"onChange"}),{register:j,handleSubmit:v,getValues:b,reset:f,setValue:w,trigger:N,formState:{errors:P},control:k}=(0,l.cI)({mode:"onChange"}),q=(0,n.useRef)(null),S=(0,n.useRef)(null),[C,$]=(0,n.useState)(e),[A,T]=(0,n.useState)(e),[F,O]=(0,n.useState)(null),[L,Z]=(0,n.useState)(0),[z,E]=(0,n.useState)(null);async function categoryTreeUpdate(){S.current=await getCategory(),O(function getCategoryNode(t){return a.jsx("ul",{role:"tree",className:o().category_group,children:t.map((t,n)=>(0,a.jsxs)("li",{role:"treeitem",tabIndex:0,children:[(0,a.jsxs)("div",{className:o().item,onMouseOver:e=>{e.stopPropagation(),e.currentTarget.style.backgroundColor="var( --background-secondary-color )",e.currentTarget.childNodes[3].style.opacity="1"},onMouseOut:e=>{e.stopPropagation(),e.currentTarget.style.removeProperty("background-color"),e.currentTarget.childNodes[3].style.removeProperty("opacity")},children:[a.jsx("span",{className:o().icon,children:t.icon?a.jsx("img",{src:`../api/media-stream/icon?id=${t.id}`,"aria-label":"アイコン",loading:"lazy"}):a.jsx(i.FontAwesomeIcon,{icon:c.cLY})}),t.name[e],a.jsx("span",{style:{marginLeft:"15px",color:"gray"},children:t.slug}),(0,a.jsxs)("span",{className:o().control,children:[a.jsx("button",{"data-name":t.name[e],"data-slug":t.slug,"data-icon":t.icon||"none","data-id":t.id,"data-rank":t.rank,"data-parent":t.parent,onClick:e=>{let a=e.currentTarget.dataset;if(a.name&&a.slug&&a.rank&&a.parent&&a.id){for(let e of(Z(1),E({name:a.name,slug:a.slug,rank:a.rank,parent:a.parent,icon:a.icon||"none",id:a.id}),w("category_id",a.id),r))w(`category_name_${e}`,t.name[e]);w("category_slug",a.slug),w("category_rank",a.rank),f({category_icon:null}),w("category_parent",a.parent)}},children:"編集"}),"\xa0/\xa0",a.jsx("button",{"data-id":t.id,children:"削除"})]})]}),t.children.length>0&&getCategoryNode(t.children)]}))})}(S.current))}async function getCategory(){return new Promise(e=>{fetch("/api/category/get",{method:"POST",cache:"no-store"}).then(async t=>{if(t.ok){let r=await t.json();console.log(r);let searchEdit=(e,t=0)=>{let r=[];for(let[a,n]of e.entries())t===n.parent&&r.push({...n,children:searchEdit(e,n.id)});return r};q.current=r,e(searchEdit(r,0))}})})}function registerCategory(e,t){let r=new FormData(t);r.set("category_parent","new"===e?m("category_parent"):b("category_parent")),fetch(`/api/category/${"new"===e?"create":"update"}`,{method:"POST",body:r,cache:"no-store"}).then(async t=>{console.log(t.ok),t.ok?(alert(`⭕カテゴリーを${"new"===e?"追加":"更新"}しました。`),"new"===e&&_(),categoryTreeUpdate()):alert(`❌カテゴリーの${"new"===e?"追加":"更新"}に失敗しました。`)})}function getParentSelectComponent(t,r,n,s,o){let i=[{label:"なし（ルート）",value:"0"},...n.map(t=>({label:`${t.name[e]} [${t.slug}]`,value:`${t.id}`}))];if(o){for(let e of i)if(e.value===o)break}return a.jsx(l.Qr,{name:r,rules:{required:!0},defaultValue:o??"0",control:t,render:({field:{onChange:e,value:t}})=>a.jsx(g.ZP,{options:i,styles:{option:e=>({...e,color:"var( --foreground-color )"}),control:e=>({...e,color:"var( --foreground-color )"}),singleValue:e=>({...e,color:"var( --foreground-color )"})},value:i.find(e=>e.value===t),onChange:t=>t&&e(t.value),maxMenuHeight:300,menuPortalTarget:document.body,theme:e=>({...e,borderRadius:0,colors:{...e.colors,primary:"var( --react-select-primary )",primary25:"var( --react-select-primary25 )",neutral0:"var( --react-select-neutral0 )",neutral80:"white"}}),"aria-labelledby":s})})}(0,n.useEffect)(()=>{categoryTreeUpdate()},[]);let V=(0,n.useCallback)(async e=>{let t=await fetch("/api/category/slug-exist",{method:"POST",body:JSON.stringify({slug:e})});if(t.ok){let{isExist:e}=await t.json();return!e||"既に同名のスラグが存在します。"}return"スラグの確認処理で、ネットワークエラーが発生しました。"},[]);return(0,a.jsxs)(a.Fragment,{children:[a.jsx("h2",{className:o().heading2,children:"カテゴリー"}),(0,a.jsxs)("div",{className:o().category_manage_wrap,children:[(0,a.jsxs)("div",{className:o().category_tree_wrap,children:[a.jsx("h3",{children:"登録カテゴリー一覧"}),a.jsx("button",{className:o().cat_new,onClick:()=>{Z(0),E(null),f()},children:"新規追加"}),a.jsx("div",{className:o().tree,children:F&&F})]}),(0,a.jsxs)("div",{className:o().category_register_wrap,children:[(0,a.jsxs)("div",{className:o().form_switch,hidden:0!==L,children:[a.jsx("h3",{children:"新規追加"}),(0,a.jsxs)("form",{onSubmit:u((e,t)=>{registerCategory("new",t?.target)}),children:[(0,a.jsxs)("div",{className:o().form_item,children:[a.jsx("div",{className:o().lang_tabs,children:r.length>1&&r.map(t=>a.jsx("button",{type:"button",className:`${o().tab} ${C===t&&o().selected}`,onClick:()=>{$(t)},children:s[e][t]}))}),a.jsx("div",{className:o().tab_content,children:r.map(e=>(0,a.jsxs)("div",{className:`${o().content} ${C===e&&o().show}`,children:[a.jsx("label",{htmlFor:"category-name-input",children:"カテゴリー名"}),a.jsx("input",{type:"text",id:"category-name-input",...d(`category_name_${e}`,{required:{value:!0,message:"入力必須項目です。"},maxLength:{value:50,message:"50文字以内で入力してください。"}})}),h[`category_name_${e}`]?.message&&a.jsx("span",{className:o().error_message,children:h[`category_name_${e}`]?.message})]}))})]}),(0,a.jsxs)("div",{className:o().form_item,children:[a.jsx("label",{htmlFor:"category-slug-input",children:"スラッグ（半角英数字[A-Za-z0-9_-]）"}),a.jsx("input",{type:"text",id:"category-slug-input",...d("category_slug",{required:{value:!0,message:"入力必須項目です。"},maxLength:{value:50,message:"50文字以内で入力してください。"},pattern:{value:/^[A-Za-z0-9_-]+$/g,message:"形式が正しくありません。"},validate:async e=>V(e)})}),h.category_slug&&h.category_slug.message&&a.jsx("span",{className:o().error_message,children:h.category_slug.message})]}),(0,a.jsxs)("div",{className:o().form_item,children:[a.jsx("label",{htmlFor:"category-rank-input",children:"ランク（数値）"}),a.jsx("input",{type:"number",id:"category-rank-input",...d("category_rank",{required:{value:!0,message:"入力必須項目です。"}}),defaultValue:"0"}),h.category_rank&&h.category_rank.message&&a.jsx("span",{className:o().error_message,children:h.category_rank.message})]}),(0,a.jsxs)("div",{className:o().form_item,children:[a.jsx("label",{id:"category-parent-input",children:"親カテゴリー（表示専用）"}),F&&getParentSelectComponent(x,"category_parent",q.current,"category-parent-input")]}),(0,a.jsxs)("div",{className:o().form_item,children:[a.jsx("label",{htmlFor:"category-icon-input",children:"アイコン"}),a.jsx("input",{type:"file",id:"category-icon-input",accept:"image/*",...d("category_icon")}),a.jsx("span",{children:"※推奨サイズ：50 X 50ピクセル程度"})]}),a.jsx("div",{className:o().form_item,style:{textAlign:"center"},children:a.jsx("button",{type:"submit",className:o().add_category_btn,children:"追加"})})]})]}),(0,a.jsxs)("div",{className:o().form_switch,hidden:1!==L,children:[(0,a.jsxs)("h3",{children:["編集 - ",z&&z.name]}),(0,a.jsxs)("form",{onSubmit:v((e,t)=>{registerCategory("edit",t?.target)}),children:[(0,a.jsxs)("div",{className:o().form_item,children:[a.jsx("div",{className:o().lang_tabs,children:r.length>1&&r.map(t=>a.jsx("button",{type:"button",className:`${o().tab} ${A===t&&o().selected}`,onClick:()=>{T(t)},children:s[e][t]}))}),a.jsx("div",{className:o().tab_content,children:r.map(e=>(0,a.jsxs)("div",{className:`${o().content} ${A===e&&o().show}`,children:[a.jsx("label",{htmlFor:"category-name-input",children:"カテゴリー名"}),a.jsx("input",{type:"text",id:"category-name-input",...j(`category_name_${e}`,{required:{value:!0,message:"入力必須項目です。"},maxLength:{value:50,message:"50文字以内で入力してください。"}})}),P[`category_name_${e}`]?.message&&a.jsx("span",{className:o().error_message,children:P[`category_name_${e}`]?.message})]}))})]}),(0,a.jsxs)("div",{className:o().form_item,children:[a.jsx("label",{htmlFor:"category-slug-input",children:"スラッグ（半角英数字[A-Za-z0-9_-]）"}),a.jsx("input",{type:"text",id:"category-slug-input",...j("category_slug",{required:{value:!0,message:"入力必須項目です。"},maxLength:{value:50,message:"50文字以内で入力してください。"},pattern:{value:/^[A-Za-z0-9_-]+$/g,message:"形式が正しくありません。"}})}),P.category_slug&&P.category_slug.message&&a.jsx("span",{className:o().error_message,children:P.category_slug.message})]}),(0,a.jsxs)("div",{className:o().form_item,children:[a.jsx("label",{htmlFor:"category-rank-input",children:"ランク（数値）"}),a.jsx("input",{type:"number",id:"category-rank-input",...j("category_rank",{required:{value:!0,message:"入力必須項目です。"}})}),P.category_rank&&P.category_rank.message&&a.jsx("span",{className:o().error_message,children:P.category_rank.message})]}),(0,a.jsxs)("div",{className:o().form_item,children:[a.jsx("label",{id:"category-parent-input",children:"親カテゴリー"}),F&&getParentSelectComponent(k,"category_parent",q.current,"category-parent-input")]}),(0,a.jsxs)("div",{className:o().form_item,children:[a.jsx("label",{htmlFor:"category-icon-input",children:"アイコン"}),a.jsx("input",{type:"file",id:"category-icon-input",accept:"image/*",...j("category_icon")}),a.jsx("span",{children:"※推奨サイズ：50 X 50ピクセル程度"})]}),(0,a.jsxs)("div",{className:o().form_item,style:{textAlign:"center"},children:[a.jsx("input",{type:"hidden",...j("category_id",{required:!0})}),a.jsx("button",{type:"submit",className:o().add_category_btn,children:"更新"})]})]})]})]})]})]})}},42523:e=>{e.exports={heading2:"content_heading2__cntOu",category_manage_wrap:"content_category_manage_wrap__Qo9bR",category_tree_wrap:"content_category_tree_wrap__BsPWi",cat_new:"content_cat_new__squ6W",tree:"content_tree___jHoW",category_group:"content_category_group__z0iAN",item:"content_item__AmPAD",icon:"content_icon__ktwvc",control:"content_control__BO_ru",focus:"content_focus__jBUYX",category_register_wrap:"content_category_register_wrap__yKmzx",form_switch:"content_form_switch__p9eyw",form_item:"content_form_item__eLW4_",lang_tabs:"content_lang_tabs__5z3Xj",tab:"content_tab__euPw7",selected:"content_selected__Xrm5p",tab_content:"content_tab_content__3_OOW",content:"content_content__XJL7Y",show:"content_show__TQVKF",error_message:"content_error_message__Z6yBl",add_category_btn:"content_add_category_btn__SUSr5"}},69184:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>Category});var a=r(55041),n=r(83873),s=r(50217),o=r(6962),i=r(18722),c=r(11208),l=r(38584),g=r(89385);let d=(0,g.createProxy)(String.raw`/var/www/next-creator/app/[lang]/admin/category/content.tsx`),{__esModule:u,$$typeof:m}=d,_=d.default;async function Category({params:{lang:e}}){let t=await (0,i.getServerSession)(o.Y);return t||(0,c.redirect)("/"),(0,a.jsxs)(a.Fragment,{children:[a.jsx(n.Z,{lang:e}),a.jsx(_,{lang:e,defaultLang:l.S.ZP,locales:l.S.Z5,localeLabels:l.S.p8}),a.jsx(s.Z,{})]})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[8807,9059,7737,7253,1419,8722,8396,1208,2187,6962,7408,7350,3239,598],()=>__webpack_exec__(19592));module.exports=r})();